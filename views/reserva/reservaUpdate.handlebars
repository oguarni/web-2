{{#if erro}}
    <div style="color: red; background-color: #ffebee; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
        {{erro}}
    </div>
{{/if}}

<h2>Editar Reserva</h2>

<form action="/reservaUpdate" method="post">
    <input type="hidden" name="id" value="{{reserva.id}}">
    
    <div style="margin-bottom: 15px;">
        <label for="titulo" style="display: block; margin-bottom: 5px; font-weight: bold;">Título da Reserva:</label>
        <input type="text" id="titulo" name="titulo" value="{{reserva.titulo}}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
    </div>
    
    <div style="margin-bottom: 15px;">
        <label for="espacoId" style="display: block; margin-bottom: 5px; font-weight: bold;">Espaço:</label>
        <select id="espacoId" name="espacoId" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
            <option value="">Selecione um espaço...</option>
            {{#each espacos}}
            <option value="{{this.id}}" {{#if (eq this.id ../reserva.espacoId)}}selected{{/if}}>
                {{this.nome}} - Capacidade: {{this.capacidade}} pessoas
            </option>
            {{/each}}
        </select>
    </div>
    
    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
        <div style="flex: 1;">
            <label for="dataInicio" style="display: block; margin-bottom: 5px; font-weight: bold;">Data e Hora de Início:</label>
            <input type="datetime-local" id="dataInicio" name="dataInicio" value="{{reserva.dataInicio}}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
        </div>
        
        <div style="flex: 1;">
            <label for="dataFim" style="display: block; margin-bottom: 5px; font-weight: bold;">Data e Hora de Fim:</label>
            <input type="datetime-local" id="dataFim" name="dataFim" value="{{reserva.dataFim}}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
        </div>
    </div>
    
    <div style="margin-bottom: 15px;">
        <label for="descricao" style="display: block; margin-bottom: 5px; font-weight: bold;">Descrição:</label>
        <textarea id="descricao" name="descricao" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Descreva o evento ou atividade...">{{reserva.descricao}}</textarea>
    </div>
    
    {{#if recursos.length}}
    <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 10px; font-weight: bold;">Recursos Necessários:</label>
        <div style="border: 1px solid #ddd; border-radius: 4px; padding: 15px; background-color: #f9f9f9;">
            {{#each recursos}}
            <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="recurso_{{this.id}}" name="recursos" value="{{this.id}}" 
                       {{#if (lookup ../recursosReserva this.id)}}checked{{/if}}
                       style="margin-right: 5px;">
                <label for="recurso_{{this.id}}" style="flex: 1;">{{this.nome}} (Disponível: {{this.quantidade}})</label>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <label for="quantidade_{{this.id}}" style="font-size: 12px;">Qtd:</label>
                    <input type="number" id="quantidade_{{this.id}}" name="quantidades[{{this.id}}]" 
                           min="1" max="{{this.quantidade}}" 
                           value="{{#if (lookup ../recursosReserva this.id)}}{{lookup ../recursosReserva this.id}}{{else}}1{{/if}}"
                           style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 3px;"
                           {{#unless (lookup ../recursosReserva this.id)}}disabled{{/unless}}>
                </div>
            </div>
            {{/each}}
        </div>
    </div>
    {{/if}}
    
    {{#if isAdmin}}
    <div style="margin-bottom: 20px;">
        <label for="status" style="display: block; margin-bottom: 5px; font-weight: bold;">Status:</label>
        <select id="status" name="status" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="pendente" {{#if (eq reserva.status "pendente")}}selected{{/if}}>Pendente</option>
            <option value="confirmada" {{#if (eq reserva.status "confirmada")}}selected{{/if}}>Confirmada</option>
            <option value="cancelada" {{#if (eq reserva.status "cancelada")}}selected{{/if}}>Cancelada</option>
        </select>
    </div>
    {{/if}}
    
    <div style="display: flex; gap: 10px;">
        <button type="submit" style="background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Atualizar Reserva</button>
        <a href="/reservaList"><button type="button" style="background-color: #95a5a6; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Cancelar</button></a>
    </div>
</form>

<script>
// Habilitar/desabilitar campos de quantidade baseado no checkbox
document.querySelectorAll('input[name="recursos"]').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const quantidadeInput = document.getElementById('quantidade_' + this.value);
        quantidadeInput.disabled = !this.checked;
        if (!this.checked) {
            quantidadeInput.value = 1;
        }
    });
});

// Validar datas
document.getElementById('dataInicio').addEventListener('change', function() {
    const dataFim = document.getElementById('dataFim');
    if (dataFim.value && this.value >= dataFim.value) {
        alert('A data de início deve ser anterior à data de fim.');
        this.value = '';
    }
});

document.getElementById('dataFim').addEventListener('change', function() {
    const dataInicio = document.getElementById('dataInicio');
    if (dataInicio.value && this.value <= dataInicio.value) {
        alert('A data de fim deve ser posterior à data de início.');
        this.value = '';
    }
});
</script>